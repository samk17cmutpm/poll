<html>
  <head>
    <title>Socket.IO chat</title> 
       <!-- Latest compiled and minified CSS -->
     <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <script src= "http://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js"></script>
    
    
  </head>
  <body>
      <!-- Fixed navbar -->
    <nav class="navbar navbar-default navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">Poll</a>
        </div>
      </div>
    </nav>
    <br>
    <br>
    <br>
    <br>
    <br>
    <div class="container">

      <div class = "row" ng-app="myApp" ng-init="type=''">
        <form>
          <div class="col-md-6" id = "content"  >
            <div class = "row" ng-controller="getQuestionCtrl">
              <div class = "row" ng-repeat="x in questions">
                <b>{{x.question_content}}</b><br><br><br>
              </div>
            </div>
            <div class = "row" id = "checktype" style = "display: none">
            </div>
            <div class = "row" id = "getidquestion" style = "display: none">
            </div>
            <div class = "row" id = "answerappend">
              
            </div>
            <div class = "row">
              <button type="submit" class="btn btn-primary" style = "width: 50%">Vote</button>
            </div>
          </div>
        </form>
        <div class="col-md-6" id = "realtime" >
          
        </div>
      </div>
    </div> <!-- /container -->
  </body>
  <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
  <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
  <script src= "http://code.highcharts.com/highcharts.js"></script>

  <script>
    var app = angular.module('myApp', []);
    var arr = [];
    app.controller('getQuestionCtrl', function($scope, $http) {
      $http.get("http://127.0.0.1:3000/questionbyid")
      .success(function (response) {$scope.questions = response;});
    });
  </script>
  <script>
    $(document).ready(function(){
      
      $.getJSON("http://127.0.0.1:3000/questionbyid", function(data){
        for (var i=0, len=data.length; i < len; i++) {
        //console.log(data[i].answer_content);
        var ab = data[i].question_type;
        console.log(ab);
        $("#checktype").html(ab);
        $("#getidquestion").html(data[i].question_id)
        }
      });

      $.getJSON("http://127.0.0.1:3000/answerbyid", function(data){
        var x=document.getElementById("checktype");
        console.log(x.innerHTML);
        if(x.innerHTML.localeCompare("single") == 0)
          console.log("yeah");
        if(x.innerHTML.localeCompare("single") == 0)
        {
          var json = "";
          for (var i=0, len=data.length; i < len; i++) {
            console.log(data[i].answer_content);
            $('<div class="row"><input type="radio" name="answer" id="'+data[i].answer_value+'">'+data[i].answer_content+'</div>').appendTo("#answerappend");
            $('<div class="row"><div class = "col-md-2" id ="sam'+data[i].answer_value+'">'+data[i].answer_vote+'</div><div class = "col-md-10">'+data[i].answer_content+'</div></div>').appendTo("#realtime");
          }
        }
        else
        {
          if(x.innerHTML.localeCompare("mutiple") == 0)
          {
            for (var i=0, len=data.length; i < len; i++) {
            console.log(data[i].answer_content);
            $('<div class="row"><input type="checkbox" name="answer" id="'+data[i].answer_value+'">'+data[i].answer_content+'</div>').appendTo("#answerappend");
            }
          }
          
        }
      });
    });


  </script>
  <script>
    var socket = io();
    var y= document.getElementById("checktype");
    var id = document.getElementById("getidquestion");
    $('form').submit(function(){
      if(y.innerHTML.localeCompare("single") == 0)
      {
        //alert("dm");
        var check = document.getElementsByName('answer');
        for(var i = 0; i < check.length; i++)
        {
          if(check[i].checked)
          {
            socket.emit('Realtimechartsingle',{question_id: id.innerHTML, value: i} );
            break;
          }
        }
      }
      else
      {

      }
      return false;
    });

    socket.on('UpdateRealtime', function(msg){
      
      document.getElementById("sam"+msg.value+"").innerHTML = msg.answer_vote;
    });
  </script>
</html>